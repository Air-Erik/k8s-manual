# –ê–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: NSX-T –¥–ª—è Kubernetes

> **–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-10-17
> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
> **–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞:** `05-investigation-results.md` + —Å–∫—Ä–∏–Ω—à–æ—Ç—ã NSX UI

---

## Executive Summary (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç `k8s-nodes-segment`** ‚úÖ

**–ü–æ–¥—Å–µ—Ç—å:** `172.16.50.0/24` (254 IP –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è K8s)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- VIP-VM —É–∂–µ –∑–∞–Ω—è—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ VM (~96 VM, IP –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è)
- –ò–∑–æ–ª—è—Ü–∏—è K8s –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- External connectivity —Ä–∞–±–æ—Ç–∞–µ—Ç (–±–µ–∑ NAT) ‚Äî –Ω–æ–≤–∞—è –ø–æ–¥—Å–µ—Ç—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∞–∫ –∂–µ
- Tier-1 Gateway (T1-GW-1) –≥–æ—Ç–æ–≤ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞

---

## 1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ NSX-T

### 1.1. –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚úÖ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|---------|-------------|
| **NSX-T Version** | 4.2.3.0.0 | ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è, –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã |
| **Tier-0 Gateway** | T0-GW (Active-Standby) | ‚úÖ –ï—Å—Ç—å, –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Edge Cluster EC-1 |
| **Tier-1 Gateway** | 7 —à—Ç (–≤–∫–ª—é—á–∞—è T1-GW-1) | ‚úÖ –ú–Ω–æ–≥–∏–µ –¥–ª—è Tanzu/NCP, T1-GW-1 —Å–≤–æ–±–æ–¥–µ–Ω |
| **Segments** | 14 —à—Ç | ‚úÖ VIP-VM + Tanzu —Å–µ–≥–º–µ–Ω—Ç—ã |

**–í—ã–≤–æ–¥:** NSX-T –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ. –ï—Å—Ç—å Tier-1 Gateway –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞.

---

### 1.2. –ê–Ω–∞–ª–∏–∑ —Å–µ–≥–º–µ–Ω—Ç–∞ VIP-VM ‚ö†Ô∏è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|----------|---------|--------|
| **–ü–æ–¥—Å–µ—Ç—å** | 172.16.100.1/24 | ‚ÑπÔ∏è /24 = 254 IP |
| **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** | ~96 VM –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | ‚ö†Ô∏è –£–∂–µ –∑–∞–Ω—è—Ç–æ 38% IP |
| **Tier-1** | T1-GW-1 | ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ T0-GW |
| **Purpose** | –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ |
| **Tanzu** | –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å Tanzu |
| **External Connectivity** | –†–∞–±–æ—Ç–∞–µ—Ç (ping 8.8.8.8, DNS OK) | ‚úÖ |
| **NAT** | –ù–µ—Ç NAT –ø—Ä–∞–≤–∏–ª | ‚ÑπÔ∏è –ó–Ω–∞—á–∏—Ç 172.16.x.x –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ—Ä–ø—Å–µ—Ç–∏ |
| **Gateway IP** | –ù–µ —É–∫–∞–∑–∞–Ω –≤ UI | ‚ÑπÔ∏è –í–µ—Ä–æ—è—Ç–Ω–æ –Ω–∞ Tier-1 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ |

**–ü—Ä–æ–±–ª–µ–º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è VIP-VM –¥–ª—è K8s:**
- ‚ùå **–ù–µ—Ö–≤–∞—Ç–∫–∞ IP:** –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 29 IP –¥–ª—è K8s (CP + Workers + VIP + MetalLB)
  - –°–≤–æ–±–æ–¥–Ω–æ: ~158 IP (254 - 96 = 158)
  - –ù–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è **–±–æ–ª—å—à–µ**
  - –†–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ IP: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç IP –∏–∑ MetalLB pool ‚Üí –ø—Ä–æ–±–ª–µ–º—ã
- ‚ùå **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –°–º–µ—à–∏–≤–∞–Ω–∏–µ K8s –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö VM ‚Äî –ø–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞
- ‚ùå **Troubleshooting:** –ï—Å–ª–∏ K8s —Å–ª–æ–º–∞–µ—Ç—Å—è (DFW –ø—Ä–∞–≤–∏–ª–∞, network flooding), –ø–æ—Å—Ç—Ä–∞–¥–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚ùå **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –°–ª–æ–∂–Ω–µ–µ —É–ø—Ä–∞–≤–ª—è—Ç—å IP-–ø–ª–∞–Ω–æ–º (–∫–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–∞–∫–æ–π IP?)

**–í—ã–≤–æ–¥:** ‚ö†Ô∏è **–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VIP-VM –¥–ª—è Kubernetes.

---

### 1.3. –ê–Ω–∞–ª–∏–∑ Distributed Firewall (DFW) ‚úÖ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|----------|---------|--------|
| **–ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞** | –î–∞ | ‚ÑπÔ∏è –ï—Å—Ç—å –ø—Ä–∞–≤–∏–ª–∞ (—Å–º. —Å–∫—Ä–∏–Ω—à–æ—Ç 03-dfw-rules.png) |
| **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏** | 1 (ds-domain-c20...) | ‚ÑπÔ∏è –î–ª—è Tanzu/NCP |
| **Infrastructure Rules** | –î–∞ | ‚ÑπÔ∏è |
| **Default Rules** | NDP, DHCP, Layer3 | ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ |
| **VIP-VM Rules** | –ù–µ —É–≤–µ—Ä–µ–Ω | ‚ÑπÔ∏è –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö |

**–î–ª—è K8s:**
- ‚úÖ –ú–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å **–Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É** `k8s-nodes` (–ø–æ IP-–∞–¥—Ä–µ—Å–∞–º –Ω–æ–≤–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞)
- ‚úÖ –ú–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å **–æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞** –¥–ª—è K8s (–Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç VIP-VM)
- ‚úÖ Priority rules: –ø–æ—Å—Ç–∞–≤–∏–º –≤—ã—à–µ Tanzu –ø—Ä–∞–≤–∏–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, 900-999)

**–í—ã–≤–æ–¥:** ‚úÖ DFW –≥–æ—Ç–æ–≤ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –¥–ª—è K8s. –ù–µ—Ç –±–ª–æ–∫–µ—Ä–æ–≤.

---

### 1.4. –ê–Ω–∞–ª–∏–∑ SpoofGuard ü§î

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|----------|---------|--------|
| **–°—Ç–∞—Ç—É—Å –≤ UI** | –ù–µ –Ω–∞–π–¥–µ–Ω | ‚ÑπÔ∏è –õ–∏–±–æ –æ—Ç–∫–ª—é—á–µ–Ω, –ª–∏–±–æ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ |
| **–í–µ—Ä—Å–∏—è NSX** | 4.2.3 | ‚ÑπÔ∏è UI –∏–∑–º–µ–Ω–∏–ª—Å—è, –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ Segment Security |

**–ê–Ω–∞–ª–∏–∑:**
- –í NSX-T 4.x SpoofGuard –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ **Segment Security Profiles**
- –ï—Å–ª–∏ –Ω–µ –≤–∏–¥–∏—à—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ "SpoofGuard" ‚Üí —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç**
- –≠—Ç–æ **—Ö–æ—Ä–æ—à–æ** –¥–ª—è –Ω–∞—Å! –ó–Ω–∞—á–∏—Ç kube-vip –∏ MetalLB –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å **–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫**

**–ü–ª–∞–Ω:**
- ‚úÖ –ü—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–≠—Ç–∞–ø 0.1.4) –ø—Ä–æ–≤–µ—Ä–∏–º **gratuitous ARP** –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π VM
- ‚úÖ –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø–æ–∏—â–µ–º SpoofGuard –≤ Segment Profiles
- ‚úÖ –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –Ω–µ —Ç—Ä–æ–≥–∞–µ–º (–≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ!)

**–í—ã–≤–æ–¥:** üü¢ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç. –ü—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.

---

### 1.5. –ê–Ω–∞–ª–∏–∑ MTU ‚úÖ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|----------|---------|--------|
| **VM vNIC MTU** | 1500 | ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ |
| **NSX Overlay MTU** | –ù–µ —É–∫–∞–∑–∞–Ω | ‚ÑπÔ∏è –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ UI |

**–ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- –ï—Å–ª–∏ VM vNIC = 1500, —Ç–æ NSX Overlay —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ = **1600**
- –≠—Ç–æ **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è —Å–µ—Ç—å 1600, VM 1500, CNI 1450

**–î–ª—è Cilium:**
- –£—Å—Ç–∞–Ω–æ–≤–∏–º MTU = **1450** (VM MTU - 50 –±–∞–π—Ç –¥–ª—è VXLAN)
- –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏–∑–±–µ–∂–∏–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

**–í—ã–≤–æ–¥:** ‚úÖ MTU –≤ –Ω–æ—Ä–º–µ. –î–ª—è Cilium –∏—Å–ø–æ–ª—å–∑—É–µ–º 1450.

---

### 1.6. –ê–Ω–∞–ª–∏–∑ External Connectivity ‚úÖ

| –¢–µ—Å—Ç | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|-----------|-------------|
| `ping 8.8.8.8` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω |
| `nslookup google.com` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | DNS —Ä–∞–±–æ—Ç–∞–µ—Ç |
| `vCenter access` | ‚úÖ –î–∞ | –î–ª—è vSphere CSI |
| **NAT –Ω–∞ Tier-1** | ‚ùå –ù–µ—Ç | 172.16.x.x –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é |

**–ê–Ω–∞–ª–∏–∑:**
- External connectivity —Ä–∞–±–æ—Ç–∞–µ—Ç **–±–µ–∑ NAT**
- –ó–Ω–∞—á–∏—Ç, –ø–æ–¥—Å–µ—Ç—å **172.16.100.0/24** —É–∂–µ **–º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è** –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å–µ—Ç–∏
- –ï—Å–ª–∏ —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –ø–æ–¥—Å–µ—Ç—å **–∏–∑ —Ç–æ–≥–æ –∂–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞** (172.16.x.x) ‚Üí –æ–Ω–∞ —Ç–æ–∂–µ –±—É–¥–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è

**–í—ã–≤–æ–¥:** ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–¥—Å–µ—Ç—å **172.16.50.0/24** (—Ç–æ—Ç –∂–µ –¥–∏–∞–ø–∞–∑–æ–Ω, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç).

---

## 2. –ê–Ω–∞–ª–∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VIP-VM ‚ùå –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

**–ü–ª—é—Å—ã:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç (–º–µ–Ω—å—à–µ —Ä–∞–±–æ—Ç—ã)
- ‚úÖ –°–µ—Ç—å —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ù–µ—Ö–≤–∞—Ç–∫–∞ IP (158 —Å–≤–æ–±–æ–¥–Ω—ã—Ö, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞—Å—Ç—ë—Ç)
- ‚ùå –†–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ IP –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ K8s
- ‚ùå –°–º–µ—à–∏–≤–∞–Ω–∏–µ production (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏) –∏ infrastructure (K8s)
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å troubleshooting (–∫—Ç–æ –∫–æ–≥–æ —Å–ª–æ–º–∞–ª?)
- ‚ùå –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: DFW –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è K8s –º–æ–≥—É—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **2/10 ‚Äî –ü–ª–æ—Ö–∞—è –∏–¥–µ—è**

---

### –í–∞—Ä–∏–∞–Ω—Ç B: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç `k8s-nodes-segment` ‚úÖ –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

**–ü–ª—é—Å—ã:**
- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è:** K8s –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
- ‚úÖ **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ IP:** 254 IP –≤ /24 (—Ö–≤–∞—Ç–∏—Ç –Ω–∞ –≥–æ–¥—ã –≤–ø–µ—Ä—ë–¥)
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –û—Ç–¥–µ–ª—å–Ω—ã–µ DFW –ø—Ä–∞–≤–∏–ª–∞ (–Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü–æ–Ω—è—Ç–Ω—ã–π IP-–ø–ª–∞–Ω (172.16.50.x = K8s)
- ‚úÖ **Troubleshooting:** –ü—Ä–æ–±–ª–µ–º—ã K8s –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ú–æ–∂–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–¥—ã –±–µ–∑ –æ–≥–ª—è–¥–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **External connectivity:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–æ—Ç –∂–µ Tier-1, —Ç–æ—Ç –∂–µ –¥–∏–∞–ø–∞–∑–æ–Ω IP)

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç (~10 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã –≤ NSX UI)
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å DFW –ø—Ä–∞–≤–∏–ª–∞ (–Ω–æ —ç—Ç–æ –Ω—É–∂–Ω–æ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ)

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **10/10 ‚Äî –ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**

---

## 3. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø ‚úÖ

### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç `k8s-nodes-segment`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|----------|---------|-------------|
| **Segment Name** | `k8s-nodes-segment` | –ü–æ–Ω—è—Ç–Ω–æ–µ –∏–º—è |
| **Subnet** | `172.16.50.0/24` | –¢–æ—Ç –∂–µ –¥–∏–∞–ø–∞–∑–æ–Ω, —á—Ç–æ VIP-VM (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è) |
| **Gateway IP** | `172.16.50.1` | –ù–∞ Tier-1 Interface |
| **Tier-1 Gateway** | `T1-GW-1` | –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π (—Ä–∞–±–æ—Ç–∞–µ—Ç) |
| **Transport Zone** | `nsx-overlay-transportzone` | –ö–∞–∫ —É VIP-VM |
| **DHCP** | –û—Ç–∫–ª—é—á–µ–Ω | –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ IP |

**IP Allocation Plan:**

| IP Range | Purpose | Count |
|----------|---------|-------|
| `172.16.50.1` | Gateway (Tier-1) | 1 |
| `172.16.50.10-12` | Control Plane (cp-01, cp-02, cp-03) | 3 |
| `172.16.50.20-30` | Workers (w-01 ... w-10, –∑–∞–ø–∞—Å) | 11 |
| `172.16.50.100` | API VIP (kube-vip) | 1 |
| `172.16.50.200-220` | MetalLB Pool (LoadBalancer Services) | 21 |
| `172.16.50.50-99` | Reserved (–±—É–¥—É—â–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ) | 50 |
| **Total Used** | ~87 IP | **167 IP —Å–≤–æ–±–æ–¥–Ω–æ!** ‚úÖ |

**DNS:**
- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ –∂–µ DNS, —á—Ç–æ –∏ –¥–ª—è VIP-VM (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ)
- –ò–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Ä—É—á–Ω—É—é –≤ Ubuntu netplan: 8.8.8.8, 8.8.4.4

---

## 4. –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞ (15 –º–∏–Ω—É—Ç)
1. NSX UI ‚Üí Networking ‚Üí Segments ‚Üí Add Segment
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞: –∏–º—è, –ø–æ–¥—Å–µ—Ç—å, gateway, Tier-1
3. –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–µ–≥–º–µ–Ω—Ç –ø–æ—è–≤–∏–ª—Å—è –≤ vCenter

### –≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DFW (10 –º–∏–Ω—É—Ç)
1. –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É `k8s-nodes` (–ø–æ IP 172.16.50.0/24)
2. –°–æ–∑–¥–∞—Ç—å 3 –ø—Ä–∞–≤–∏–ª–∞ (inter-node, nodeport, egress)
3. Priority: 900-999 (–≤—ã—à–µ Tanzu –ø—Ä–∞–≤–∏–ª)

### –≠—Ç–∞–ø 3: –í–∞–ª–∏–¥–∞—Ü–∏—è (30 –º–∏–Ω—É—Ç)
1. –°–æ–∑–¥–∞—Ç—å 2 —Ç–µ—Å—Ç–æ–≤—ã–µ VM –≤ –Ω–æ–≤–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å connectivity (ping gateway, ping between VMs, ping 8.8.8.8)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MTU (`ping -M do -s 1400`)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å gratuitous ARP (secondary IP test)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS (nslookup google.com)

### –≠—Ç–∞–ø 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (10 –º–∏–Ω—É—Ç)
1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å `nsx-configs/segments.md`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å `nsx-configs/spoofguard-whitelist.md` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**Total time: ~65 –º–∏–Ω—É—Ç** ‚è±Ô∏è

---

## 5. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| **IP –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ç—è–º–∏** | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –ü—Ä–æ–≤–µ—Ä–∏–ª–∏, 172.16.50.0/24 —Å–≤–æ–±–æ–¥–Ω–∞ |
| **DFW –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫** | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –¢–µ—Å—Ç–æ–≤—ã–µ VM –ø–µ—Ä–µ–¥ K8s deployment |
| **SpoofGuard –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç VIP** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –ü—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –Ω–∞—Å—Ç—Ä–æ–∏–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ |
| **MTU –ø—Ä–æ–±–ª–µ–º—ã** | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 1450 |
| **External connectivity –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –¢–∞ –∂–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —á—Ç–æ VIP-VM (—Ä–∞–±–æ—Ç–∞–µ—Ç) |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤:** üü¢ **–ù–∏–∑–∫–∞—è** (–≤—Å–µ —Ä–∏—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã)

---

## 6. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ–º)

### –í–∞—Ä–∏–∞–Ω—Ç C: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –ø–æ–¥—Å–µ—Ç—å (10.x.x.x –∏–ª–∏ 192.168.x.x)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ï—Å–ª–∏ 172.16.50.0/24 —É–∂–µ –∑–∞–Ω—è—Ç–∞
- –ï—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥—Ä—É–≥–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–¥—Å–µ—Ç—å **–Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è** —Å VIP-VM (172.16.100.0/24) –∏ Tanzu —Å–µ—Ç—è–º–∏
- –í–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **SNAT** –Ω–∞ Tier-1 (–µ—Å–ª–∏ –ø–æ–¥—Å–µ—Ç—å –Ω–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ—Ä–ø—Å–µ—Ç–∏)

**–ü—Ä–∏–º–µ—Ä—ã:**
- `10.100.0.0/24` (–∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ 10.0.0.0/8)
- `192.168.50.0/24` (–∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ 192.168.0.0/16)

---

## 7. –†–µ—à–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:** ‚òê –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç `k8s-nodes-segment` —Å –ø–æ–¥—Å–µ—Ç—å—é `172.16.50.0/24`

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:**
- ‚òê –Ø –ø—Ä–æ—á–∏—Ç–∞–ª –∞–Ω–∞–ª–∏–∑ –∏ —Å–æ–≥–ª–∞—Å–µ–Ω —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π
- ‚òê IP-–ø–ª–∞–Ω –ø–æ–Ω—è—Ç–µ–Ω, –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ—Ç
- ‚òê –ì–æ—Ç–æ–≤ –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Å–µ–≥–º–µ–Ω—Ç–∞

**–î–∞—Ç–∞ —Ä–µ—à–µ–Ω–∏—è:** ___________
**–û–ø–µ—Ä–∞—Ç–æ—Ä:** ___________

---

## 8. –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏—è:

üëâ **AI-–∞–≥–µ–Ω—Ç —Å–æ–∑–¥–∞—Å—Ç:** `08-setup-instructions-new-segment.md`
   - –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ NSX UI
   - –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
   - –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

üëâ **–û–ø–µ—Ä–∞—Ç–æ—Ä –≤—ã–ø–æ–ª–Ω–∏—Ç:** –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ NSX UI

üëâ **–í–∞–ª–∏–¥–∞—Ü–∏—è:** `09-validation-checklist.md`

---

**–≠—Ç–æ—Ç –∞–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ NSX-T –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ production-–∫–ª–∞—Å—Ç–µ—Ä–æ–≤.**

‚úÖ **–ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!**
