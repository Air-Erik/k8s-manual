# NSX-T: –®–∞–±–ª–æ–Ω —Å–æ–∑–¥–∞–Ω–∏—è T1 –ø–æ–¥ –∫–ª–∞—Å—Ç–µ—Ä Kubernetes (–≤–∞—Ä–∏–∞–Ω—Ç ‚Äú–æ–¥–∏–Ω T1 –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä‚Äù)

–≠—Ç–æ—Ç –≥–∞–π–¥ ‚Äî –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –ø–æ–¥–Ω–∏–º–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–µ—Ç—å –¥–ª—è k8s-–∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ NSX‚ÄëT: —Å–æ–∑–¥–∞—ë–º **Tier‚Äë1**, **overlay‚Äë—Å–µ–≥–º–µ–Ω—Ç** —Å–µ—Ç–∏ —É–∑–ª–æ–≤, **NAT** (No‚ÄëSNAT + SNAT), –ø–æ–¥–∫–ª—é—á–∞–µ–º –í–ú/–Ω–æ–¥—ã –∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º **Ingress** —á–µ—Ä–µ–∑ NSX Load Balancer –∏–ª–∏ DNAT.  
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å—Ö–µ–º—ã, –≥–¥–µ —É –≤–∞—Å **Tier‚Äë0 —É–∂–µ –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ ‚Äú–≤–Ω–µ—à–Ω–µ–π‚Äù VLAN (–Ω–∞–ø—Ä–∏–º–µ—Ä, 172.16.50.0/24) –∏ –∏–º–µ–µ—Ç default‚Äëroute –≤ –ø–µ—Ä–∏–º–µ—Ç—Ä/–∏–Ω—Ç–µ—Ä–Ω–µ—Ç**.

---

## 0) –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω –∞–¥—Ä–µ—Å–æ–≤ (–∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–¥ —Å–µ–±—è)

```text
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ù–û–í–û–ì–û –ö–õ–ê–°–¢–ï–†–ê
CLUSTER_NAME         = k8s-<env>-<team>          # –Ω–∞–ø—Ä. k8s-zeon-dev
NODE_SUBNET_CIDR     = 10.246.10.0/24            # —Å–µ—Ç—å —É–∑–ª–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞ (overlay)
NODE_GW_IP           = 10.246.10.1/24            # —à–ª—é–∑ —Å–µ–≥–º–µ–Ω—Ç–∞ (LIF T1)
VIP_POOL_CIDR        = 172.16.50.192/27          # –ø—É–ª VIP'–æ–≤ –¥–ª—è Ingress/LB (–≤–Ω–µ—à–Ω—è—è VLAN)
EGRESS_SNAT_IP       = 172.16.50.230             # —Å–≤–æ–±–æ–¥–Ω—ã–π IP –≤–æ –≤–Ω–µ—à–Ω–µ–π VLAN –¥–ª—è SNAT
DNS_IPS              = 172.17.10.3,8.8.8.8       # DNS —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –Ω–æ–¥/–í–ú
T0_NAME              = TO-GW                     
EDGE_CLUSTER         = EC-1                       # –≤–∞—à Edge Cluster
TRANSPORT_ZONE       = nsx-overlay-transportzone  # Overlay TZ
```

> **–í–∞–∂–Ω–æ:** –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–π—Ç–µ—Å—å —Å —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ —Å–µ—Ç—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –≤–∞—à–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ Tanzu –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `10.244.0.0/20` –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ 100.64.0.0/10 –¥–ª—è T0‚ÜîT1).  
> –ü–æ–¥—Å–µ—Ç–∏ **Pods/Services** –≤ —Å–∞–º–æ–º k8s –∑–∞–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Pods `10.200.0.0/16`, Services `10.96.0.0/12`). –û–Ω–∏ **–Ω–µ —Ä–∞–≤–Ω—ã** —Å–µ—Ç–∏ —É–∑–ª–æ–≤ –∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —Å –Ω–µ–π –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è.

---

## 1) –°–æ–∑–¥–∞–Ω–∏–µ Tier‚Äë1 Gateway

**–ü—É—Ç—å:** `Networking ‚Üí Tier‚Äë1 Gateways ‚Üí ADD TIER‚Äë1 GATEWAY`

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
- **Name:** `T1-<CLUSTER_NAME>` (–Ω–∞–ø—Ä. `T1-k8s-zeon-dev`)
- **HA Mode:** `Active-Standby`  _(—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è NAT/LB)_
- **Linked Tier‚Äë0 Gateway:** `T0_NAME` (–Ω–∞–ø—Ä. `TO-GW`)
- **Edge Cluster:** `EDGE_CLUSTER` (–Ω–∞–ø—Ä. `EC-1`)
- **Edges Pool Allocation Size:** `ROUTING` _(–º–∏–Ω–∏–º—É–º; –ø–æ–º–µ–Ω—è–µ—Ç–µ –Ω–∞ LB_SMALL, –µ—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ NSX-LB)_
- **Route Advertisement ‚Üí –≤–∫–ª—é—á–∏—Ç—å:**
  - **All Connected Segments & Service Ports = Yes** ‚úÖ
  - **All NAT IPs = Yes** ‚úÖ (–Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã T0 ¬´–≤–∏–¥–µ–ª¬ª NAT/VIP –º–∞—Ä—à—Ä—É—Ç—ã T1)
  - (–æ–ø—Ü.) **All LB VIP Routes** –∏ **All LB SNAT IP Routes** = Yes, –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ NSX‚ÄëLB

**Save ‚Üí Publish.**

---

## 2) –°–æ–∑–¥–∞–Ω–∏–µ overlay‚Äë—Å–µ–≥–º–µ–Ω—Ç–∞ —Å–µ—Ç–∏ —É–∑–ª–æ–≤

**–ü—É—Ç—å:** `Networking ‚Üí Segments ‚Üí ADD SEGMENT`

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
- **Segment Name:** `seg-<CLUSTER_NAME>-nodes` (–Ω–∞–ø—Ä. `seg-k8s-zeon-dev-nodes`)
- **Connected Gateway:** `T1-<CLUSTER_NAME>` (–Ω–∞–ø—Ä. `T1-k8s-zeon-dev`)
- **Transport Zone:** `TRANSPORT_ZONE` (Overlay)
- **Subnets ‚Üí Gateway CIDR IP:** `NODE_GW_IP` (–Ω–∞–ø—Ä. `10.246.10.1/24`) ‚Üí —ç—Ç–æ **—à–ª—é–∑** –¥–ª—è –Ω–æ–¥
- **(–û–ø—Ü.) SET DHCP CONFIG**, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–¥–∞–≤–∞—Ç—å IP –∏–∑ NSX:
  - **DHCP Server Address:** —Å–≤–æ–±–æ–¥–Ω—ã–π IP –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ç–∏ (–Ω–∞–ø—Ä. `10.246.10.2/24`)
  - **DHCP Ranges:** –Ω–∞–ø—Ä. `10.246.10.100-10.246.10.200`
  - **IPv4 Gateway:** –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (`10.246.10.1/24`)
  - **DNS Servers:** `DNS_IPS`

**Save ‚Üí Publish.**

> –ß–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞: –≤ –ø–æ–ª–µ *Gateway CIDR IP* –≤–≤–æ–¥—è—Ç **—Å–µ—Ç—å (`10.246.10.0/24`)**, –∞ –Ω–µ **–∞–¥—Ä–µ—Å —à–ª—é–∑–∞** (`10.246.10.1/24`). –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–º–µ–Ω–Ω–æ **–∞–¥—Ä–µ—Å**, –Ω–µ —Å–µ—Ç—å.

---

## 3) –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –í–ú/–Ω–æ–¥ –∫ —Å–µ–≥–º–µ–Ω—Ç—É + —Å–µ—Ç—å –≤–Ω—É—Ç—Ä–∏ –í–ú

–í vSphere —É –í–ú: **Edit Settings ‚Üí Network adapter ‚Üí** –≤—ã–±—Ä–∞—Ç—å —Å–µ–≥–º–µ–Ω—Ç `seg-<CLUSTER_NAME>-nodes`.

–ï—Å–ª–∏ –±–µ–∑ DHCP, –Ω–∞ –∫–∞–∂–¥–æ–π –í–ú/–Ω–æ–¥–µ –ø—Ä–æ–ø–∏—à–∏—Ç–µ **—Å—Ç–∞—Ç–∏–∫—É**:
- **IP:** —Å–≤–æ–±–æ–¥–Ω—ã–π –∏–∑ `NODE_SUBNET_CIDR` (–Ω–∞–ø—Ä. `10.246.10.10/24`)
- **Gateway:** `10.246.10.1`
- **DNS:** `DNS_IPS`

–ü—Ä–∏–º–µ—Ä –¥–ª—è Ubuntu (netplan):
```yaml
# /etc/netplan/01-k8s.yaml
network:
  version: 2
  ethernets:
    ens192:
      addresses: [10.246.10.10/24]
      gateway4: 10.246.10.1
      nameservers:
        addresses: [172.17.10.3, 8.8.8.8]
```
```bash
sudo netplan apply
```

---

## 4) NAT –Ω–∞ T1: No‚ÄëSNAT (–∏—Å–∫–ª—é—á–µ–Ω–∏—è) + SNAT (egress)

**–ü—É—Ç—å:** `Networking ‚Üí NAT ‚Üí Gateway: T1-<CLUSTER_NAME>`

### 4.1 No‚ÄëSNAT –∫ VIP‚Äë–ø—É–ª—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ)
**–ó–∞—á–µ–º:** –∫–æ–≥–¥–∞ –ø–æ–¥—ã/–Ω–æ–¥—ã –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ Ingress‚ÄëVIP (health‚Äëchecks/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤—ã–∑–æ–≤—ã), –∏—Å—Ö–æ–¥–Ω—ã–π –∞–¥—Ä–µ—Å **–Ω–µ –¥–æ–ª–∂–µ–Ω** –ø–µ—Ä–µ–æ–¥–µ–≤–∞—Ç—å—Å—è. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç hairpin‚Äë–ø—Ä–æ–±–ª–µ–º—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π IP –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ª–æ–≥–∞—Ö.

- **Name:** `no_snat_to_vips`
- **Action:** `No SNAT`
- **Source IP:** `NODE_SUBNET_CIDR` (–Ω–∞–ø—Ä. `10.246.10.0/24`)
- **Destination IP | Port:** `VIP_POOL_CIDR` (–Ω–∞–ø—Ä. `172.16.50.192/27`)
- **Logging:** `On`
- **Priority:** `10`

### 4.2 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) No‚ÄëSNAT –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å–µ—Ç—è–º
**–ó–∞—á–µ–º:** –µ—Å–ª–∏ –Ω–æ–¥–∞–º –Ω—É–∂–Ω–æ —Ö–æ–¥–∏—Ç—å **–±–µ–∑ NAT** –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É registry/CI).  
> –ü–æ–º–Ω–∏—Ç–µ: —É —ç—Ç–∏—Ö —Å–µ—Ç–µ–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–æ–±—Ä–∞—Ç–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** –≤ `NODE_SUBNET_CIDR`.

- **Name:** `no_snat_to_internal`
- **Action:** `No SNAT`
- **Source IP:** `NODE_SUBNET_CIDR`
- **Destination IP:** —Å–ø–∏—Å–æ–∫ –Ω—É–∂–Ω—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ç–µ–π (–Ω–∞–ø—Ä. `172.16.100.0/24`, `172.16.50.0/24`)
- **Priority:** `20`
- **Logging:** `On`

### 4.3 SNAT (catch‚Äëall egress –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
**–ó–∞—á–µ–º:** –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏—Å—Ö–æ–¥—è—â–µ–µ ¬´–º–∞—Å–∫–∏—Ä—É–µ–º¬ª –≤ –æ–¥–∏–Ω –≤–Ω–µ—à–Ω–∏–π IP ‚Äî **–∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–∞ –∞–ø—Å—Ç—Ä–∏–º–µ**.

- **Name:** `snat_to_internet`
- **Action:** `SNAT`
- **Source IP:** `NODE_SUBNET_CIDR` (–Ω–∞–ø—Ä. `10.246.10.0/24`)
- **Destination IP | Port:** _–ø—É—Å—Ç–æ_ (–ª—é–±–æ–π)
- **Translated IP:** `EGRESS_SNAT_IP` (–Ω–∞–ø—Ä. `172.16.50.230`)
- **Priority:** `100`
- **Logging:** `On`

> **–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∞–≤–∏–ª –≤–∞–∂–µ–Ω:** –≤—Å–µ **No‚ÄëSNAT** —Å—Ç–æ—è—Ç **–≤—ã—à–µ**, **SNAT** ‚Äî –Ω–∏–∂–µ.  
> –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ **Publish** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É SNAT **—Ä–∞—Å—Ç—É—Ç Hits** (—Å—á—ë—Ç—á–∏–∫–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π).

---

## 5) (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Ingress –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç A ‚Äî NSX‚ÄëT Load Balancer (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –í–∫–ª—é—á–∏—Ç–µ Load Balancer –Ω–∞ T1 (`Allocation Size` ‚Üí `LB_SMALL` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).
2. –°–æ–∑–¥–∞–π—Ç–µ:
   - **Service Monitor** (HTTP/HTTPS),
   - **Pool** ‚Äî backend: NodePort‚Äô—ã `ingress-nginx` –Ω–∞ –Ω–æ–¥–∞—Ö (–Ω–∞–ø—Ä. `10.246.10.x:30080/30443`),
   - **Virtual Server (VIP)**: IP –∏–∑ `VIP_POOL_CIDR` (–Ω–∞–ø—Ä. `172.16.50.200:80/443`) ‚Üí –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫ –ø—É–ª—É.
3. –í DNS –Ω–∞–ø—Ä–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω—ã –Ω–∞ —ç—Ç–æ—Ç VIP.

### –í–∞—Ä–∏–∞–Ω—Ç B ‚Äî DNAT –Ω–∞ NodePort (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç, –±–µ–∑ LB)
–°–æ–∑–¥–∞–π—Ç–µ –ø–æ –ø—Ä–∞–≤–∏–ª—É –Ω–∞ –ø–æ—Ä—Ç:
- **DNAT:** `172.16.50.200:443 ‚Üí 10.246.10.10:30443`
- **DNAT:** `172.16.50.200:80  ‚Üí 10.246.10.10:30080`

–ú–∏–Ω—É—Å—ã DNAT: –Ω–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏/health‚Äëchecks, –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–æ–¥–µ.

---

## 6) Firewall‚Äë–ø–æ–ª–∏—Ç–∏–∫–∏ (–º–∏–Ω–∏–º—É–º –¥–ª—è –∑–∞–ø—É—Å–∫–∞)

- **Gateway Firewall (T0/T1):** –æ—Å—Ç–∞–≤—å—Ç–µ `Allow` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –æ–Ω —É –≤–∞—Å –∏ —Ç–∞–∫ —Ä–∞–∑—Ä–µ—à–∞—é—â–∏–π.
- **Distributed Firewall (DFW):**
  - –°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É `grp-<CLUSTER_NAME>-nodes` (–ø–æ —Å–µ–≥–º–µ–Ω—Ç—É –∏–ª–∏ —Ç–µ–≥–∞–º –í–ú).
  - –ù–∞ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ –¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–µ `Allow egress` –¥–ª—è –≥—Ä—É–ø–ø—ã.
  - –ü–æ–∑–∂–µ —Å—É–∑—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ (–¥–æ—Å—Ç—É–ø—ã –≤ —Ä–µ–µ—Å—Ç—Ä—ã, –∞–ø–¥–µ–π—Ç—ã, –∏—Å—Ö–æ–¥—è—â–∏–µ 443 –∏ —Ç.–¥.).

---

## 7) –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞

**–ù–∞ –í–ú/–Ω–æ–¥–µ:**
```bash
ip addr
ip route | grep default            # –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ –Ω–∞ NODE_GW_IP
ping -c3 NODE_GW_IP                # –ø–∏–Ω–≥ —à–ª—é–∑–∞
tracepath -n 8.8.8.8               # –≥–¥–µ ¬´–ª–æ–º–∞–µ—Ç—Å—è¬ª –º–∞—Ä—à—Ä—É—Ç
curl -s ifconfig.co                # –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π IP/–ø—É—Ç—å
nslookup google.com 8.8.8.8        # –ø—Ä–æ–≤–µ—Ä–∫–∞ DNS
```

**–í NSX:**
- `T1 ‚Üí NAT`: —É `snat_to_internet` —Ä–∞—Å—Ç—É—Ç **Hits**.
- `Plan & Troubleshoot ‚Üí Traceflow`: –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî –ø–æ—Ä—Ç –í–ú, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî `8.8.8.8` (—É–≤–∏–¥–∏—Ç–µ, –≥–¥–µ –¥—Ä–æ–ø).
- `Tier‚Äë1 ‚Üí Route Advertisement`: –≤–∫–ª—é—á–µ–Ω—ã —Ñ–ª–∞–≥–∏ –∫–∞–∫ –≤ —à–∞–≥–µ 1.

**–¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏:**
- –í —Å–µ–≥–º–µ–Ω—Ç–µ —É–∫–∞–∑–∞–ª–∏ **—Å–µ—Ç—å** –≤–º–µ—Å—Ç–æ **–∞–¥—Ä–µ—Å–∞ —à–ª—é–∑–∞**.
- –ó–∞–±—ã—Ç **SNAT** –∏–ª–∏ –æ–Ω –Ω–∏–∂–µ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –∫–∞–∫–æ–≥–æ‚Äë—Ç–æ –ø—Ä–∞–≤–∏–ª–∞.
- –í–∫–ª—é—á–∏–ª–∏ `No‚ÄëSNAT` –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å–µ—Ç—è–º, –Ω–æ **–Ω–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞** ‚Äî —Ç—Ä–∞—Ñ–∏–∫ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è.
- DFW —Ä–µ–∂–µ—Ç egress (–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–∞–π—Ç–µ Allow –¥–ª—è –≥—Ä—É–ø–ø—ã –∫–ª–∞—Å—Ç–µ—Ä–∞).

---

## 8) –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ: –µ—â—ë –∫–ª–∞—Å—Ç–µ—Ä—ã

–ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ —à–∞–≥–∏ 1‚Äì7 –Ω–∞ **–Ω–æ–≤–æ–º T1** —Å **–Ω–æ–≤–æ–π /24** –∏–∑ –≤–∞—à–µ–≥–æ –±–ª–æ–∫–∞ –∏ **–Ω–æ–≤—ã–º SNAT‚ÄëIP**.  
–ü—Ä–∏–º–µ—Ä –∞–¥—Ä–µ—Å–∞—Ü–∏–∏:
| –ö–ª–∞—Å—Ç–µ—Ä           | –°–µ—Ç—å —É–∑–ª–æ–≤ (/24) | –®–ª—é–∑ (T1 LIF) | SNAT IP        | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-------------------|------------------|---------------|----------------|------------|
| k8s-zeon-dev      | 10.246.10.0/24   | 10.246.10.1   | 172.16.50.230  | VIP: 172.16.50.200 |
| k8s-zeon-stage    | 10.246.20.0/24   | 10.246.20.1   | 172.16.50.231  | VIP: 172.16.50.201 |
| k8s-zeon-prod     | 10.246.30.0/24   | 10.246.30.1   | 172.16.50.232  | VIP: 172.16.50.202 |

> –ï—Å–ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ –≤–æ –≤–Ω–µ—à–Ω–µ–π VLAN –º–∞–ª–æ, –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–æ–¥–∏–Ω SNAT‚ÄëIP** –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö ¬´–ª—ë–≥–∫–∏—Ö¬ª –∫–ª–∞—Å—Ç–µ—Ä–æ–≤, –Ω–æ –ª—É—á—à–µ ‚Äî –ø–æ –æ–¥–Ω–æ–º—É IP –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä (–ø—Ä–æ—â–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –±–æ–ª—å—à–µ –∑–∞–ø–∞—Å –ø–æ —Å–µ—Å—Å–∏—è–º).

---

### –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫‚Äë–ª–∏—Å—Ç (—Å–≤–æ–¥–Ω–æ)

- [ ] –°–æ–∑–¥–∞–Ω `T1-<CLUSTER_NAME>`, –ø—Ä–∏–≤—è–∑–∞–Ω –∫ `T0`, –≤–∫–ª—é—á—ë–Ω Route Advertisement.
- [ ] –°–æ–∑–¥–∞–Ω overlay‚Äë—Å–µ–≥–º–µ–Ω—Ç `seg-<CLUSTER_NAME>-nodes`, `Gateway CIDR = NODE_GW_IP`.
- [ ] –í–ú/–Ω–æ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ —Å–µ–≥–º–µ–Ω—Ç—É; IP/—à–ª—é–∑/DNS –≤—ã—Å—Ç–∞–≤–ª–µ–Ω—ã.
- [ ] –ù–∞ T1 —Å–æ–∑–¥–∞–Ω—ã NAT‚Äë–ø—Ä–∞–≤–∏–ª–∞: `no_snat_to_vips` (–∏, –ø—Ä–∏ –Ω—É–∂–¥–µ, `no_snat_to_internal`) **–≤—ã—à–µ**, `snat_to_internet` **–Ω–∏–∂–µ**.
- [ ] SNAT‚Äë–ø—Ä–∞–≤–∏–ª–æ –ø–æ–ª—É—á–∞–µ—Ç **Hits**.
- [ ] (–û–ø—Ü.) NSX‚ÄëLB –∏–ª–∏ DNAT –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å–∞–º.
- [ ] DFW/GW‚ÄëFW –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç egress.

–£–¥–∞—á–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤! üöÄ
