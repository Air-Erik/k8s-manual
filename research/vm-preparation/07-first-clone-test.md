# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–æ–Ω–∞ Template

> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-27
> **–°—Ç–∞—Ç—É—Å:** ‚úÖ COMPLETED
> **AI-–∞–≥–µ–Ω—Ç:** VM Preparation Specialist

---

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∫–ª–æ–Ω–∞ VM –∏–∑ Template –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Template —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –≥–æ—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Production –∫–ª–∞—Å—Ç–µ—Ä–∞.

---

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- ‚úÖ Template `k8s-ubuntu2404-template` —Å–æ–∑–¥–∞–Ω –≤ vSphere
- ‚úÖ NSX-T —Å–µ–≥–º–µ–Ω—Ç `k8s-zeon-dev-segment` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ IP-–ø–ª–∞–Ω –≥–æ—Ç–æ–≤ (10.246.10.0/24)
- ‚úÖ SSH –∫–ª—é—á–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –≥–æ—Ç–æ–≤—ã

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ vSphere Client
- ‚úÖ SSH –∫–ª–∏–µ–Ω—Ç
- ‚úÖ –°–∫—Ä–∏–ø—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (`scripts/validate-vm-template.sh`)

---

## –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 1.1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–æ–≤–æ–π VM

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|----------|----------|-------------|
| **–ò–º—è VM** | `k8s-test-node` | –¢–µ—Å—Ç–æ–≤–∞—è –Ω–æ–¥–∞ |
| **IP –∞–¥—Ä–µ—Å** | `10.246.10.250` | –í—Ä–µ–º–µ–Ω–Ω—ã–π IP –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| **Hostname** | `k8s-test-node` | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–º–µ–Ω–∏ VM |
| **–î–æ–º–µ–Ω** | `zeon-dev.local` | –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–æ–º–µ–Ω |
| **–†–∞–∑–º–µ—Ä—ã** | 2 vCPU, 8 GB RAM, 80 GB Disk | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |

### 1.2. Cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∞

```yaml
#cloud-config
# –¢–µ—Å—Ç–æ–≤–∞—è cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Template
# –ê–≤—Ç–æ—Ä: AI-–∞–≥–µ–Ω—Ç VM Preparation Specialist
# –î–∞—Ç–∞: 2025-01-27

# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
hostname: k8s-test-node
fqdn: k8s-test-node.zeon-dev.local

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users:
  - name: k8s-admin
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    groups: [adm, systemd-journal, docker]
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC... operator@workstation
    home: /home/k8s-admin
    create_home: true

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ SSH
ssh_pwauth: false
disable_root: true
ssh_deletekeys: true
ssh_genkeytypes: ['rsa', 'ecdsa', 'ed25519']

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏
network:
  config: disabled

# –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
write_files:
  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ IP
  - path: /etc/netplan/01-static-ip.yaml
    content: |
      network:
        version: 2
        ethernets:
          ens192:
            addresses: [10.246.10.250/24]
            gateway4: 10.246.10.1
            nameservers:
              addresses: [172.17.10.3, 8.8.8.8]
            dhcp4: false
            dhcp6: false
    permissions: '0644'
    owner: root:root

  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ kubelet –¥–ª—è containerd
  - path: /etc/default/kubelet
    content: |
      KUBELET_EXTRA_ARGS="--container-runtime=remote --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock --runtime-cgroups=/system.slice/containerd.service"
    permissions: '0644'
    owner: root:root

  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ sysctl –¥–ª—è Kubernetes
  - path: /etc/sysctl.d/99-kubernetes.conf
    content: |
      # IP forwarding –¥–ª—è pod networking
      net.ipv4.ip_forward = 1
      net.ipv6.conf.all.forwarding = 1

      # Bridge netfilter –¥–ª—è CNI
      net.bridge.bridge-nf-call-iptables = 1
      net.bridge.bridge-nf-call-ip6tables = 1

      # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
      net.core.somaxconn = 32768
      net.core.netdev_max_backlog = 5000
      net.ipv4.tcp_max_syn_backlog = 8192
    permissions: '0644'
    owner: root:root

  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥—É–ª–µ–π —è–¥—Ä–∞
  - path: /etc/modules-load.d/kubernetes.conf
    content: |
      overlay
      br_netfilter
    permissions: '0644'
    owner: root:root

  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ timezone
  - path: /etc/timezone
    content: |
      UTC
    permissions: '0644'
    owner: root:root

# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
runcmd:
  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - netplan apply

  # –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª–∏ —è–¥—Ä–∞
  - modprobe overlay
  - modprobe br_netfilter

  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å sysctl –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - sysctl --system

  # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å timezone
  - timedatectl set-timezone UTC

  # –í–∫–ª—é—á–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å containerd
  - systemctl enable containerd
  - systemctl start containerd

  # –í–∫–ª—é—á–∏—Ç—å kubelet (–Ω–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–æ kubeadm init)
  - systemctl enable kubelet

  # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å systemd
  - systemctl daemon-reload

  # –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø–∞–∫–µ—Ç–æ–≤
  - apt clean

  # –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è SSH –∫–ª—é—á–µ–π
  - mkdir -p /home/k8s-admin/.ssh
  - chmod 700 /home/k8s-admin/.ssh
  - chown k8s-admin:k8s-admin /home/k8s-admin/.ssh

  # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å firewall –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - ufw --force enable
  - ufw allow ssh
  - ufw allow 10250/tcp
  - ufw allow 30000:32767/tcp
  - ufw allow 80/tcp
  - ufw allow 443/tcp

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
cloud_init_modules:
  - migrator
  - seed_random
  - bootcmd
  - write-files
  - growpart
  - resizefs
  - disk_setup
  - mounts
  - set-passwords
  - ssh

cloud_final_modules:
  - package-update-upgrade-install
  - runcmd
  - byobu
  - landscape
  - lxd
  - puppet
  - chef
  - salt-minion
  - mcollective
  - disable-ec2-metadata
  - final-message
  - power-state-change

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
final_message: |
  ==========================================
  üéâ Kubernetes Test VM –≥–æ—Ç–æ–≤–∞!
  ==========================================

  –•–æ—Å—Ç: k8s-test-node
  IP: 10.246.10.250
  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: k8s-admin

  –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
  1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ssh k8s-admin@10.246.10.250
  2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é: ./scripts/validate-vm-template.sh
  3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ kubeadm: kubeadm config images list

  ==========================================

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
package_update: false
package_upgrade: false
package_reboot_if_required: false
```

---

## –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π VM

### 2.1. –°–æ–∑–¥–∞–Ω–∏–µ VM –≤ vSphere

**–í vSphere Client:**

1. **–ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ Template** ‚Üí "Deploy Virtual Machine from this Template"
2. **–ò–º—è VM:** `k8s-test-node`
3. **–†–∞–∑–º–µ—Ä—ã:** 2 vCPU, 8 GB RAM, 80 GB Disk
4. **–°–µ—Ç—å:** k8s-zeon-dev-segment
5. **Cloud-init:** –í—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤—ã—à–µ

### 2.2. –ó–∞–ø—É—Å–∫ VM

1. **–í–∫–ª—é—á–∏—Ç—å VM** –∏ –¥–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å** –≤ vSphere Client
3. **–î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è cloud-init** (–æ–±—ã—á–Ω–æ 2-3 –º–∏–Ω—É—Ç—ã)

---

## –≠—Ç–∞–ø 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 3.1. SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ç–µ—Å—Ç–æ–≤–æ–π VM
ssh k8s-admin@10.246.10.250

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å hostname
hostname
# –û–∂–∏–¥–∞–µ—Ç—Å—è: k8s-test-node

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP –∞–¥—Ä–µ—Å
ip addr show
# –û–∂–∏–¥–∞–µ—Ç—Å—è: 10.246.10.250/24

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å gateway
ip route show
# –û–∂–∏–¥–∞–µ—Ç—Å—è: default via 10.246.10.1
```

### 3.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ cloud-init

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å cloud-init
sudo systemctl status cloud-init
# –û–∂–∏–¥–∞–µ—Ç—Å—è: active (running)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ cloud-init
sudo journalctl -u cloud-init
# –û–∂–∏–¥–∞–µ—Ç—Å—è: —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
sudo cat /var/lib/cloud/instance/scripts/final-message
# –û–∂–∏–¥–∞–µ—Ç—Å—è: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ VM
```

---

## –≠—Ç–∞–ø 4: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

### 4.1. –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```bash
# –°–∫–∞—á–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
wget https://raw.githubusercontent.com/your-repo/scripts/validate-vm-template.sh
chmod +x validate-vm-template.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
./validate-vm-template.sh
```

### 4.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –í–µ—Ä—Å–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- ‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

**–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏:**
- ‚ùå –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ Template
- ‚ùå –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚ùå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

---

## –≠—Ç–∞–ø 5: –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 5.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é –û–°
lsb_release -a
# –û–∂–∏–¥–∞–µ—Ç—Å—è: Ubuntu 24.04 LTS

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
uname -m
# –û–∂–∏–¥–∞–µ—Ç—Å—è: x86_64

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é —è–¥—Ä–∞
uname -r
# –û–∂–∏–¥–∞–µ—Ç—Å—è: 6.8.x
```

### 5.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å swap
free -h
# –û–∂–∏–¥–∞–µ—Ç—Å—è: Swap = 0B

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP forwarding
sysctl net.ipv4.ip_forward
# –û–∂–∏–¥–∞–µ—Ç—Å—è: net.ipv4.ip_forward = 1

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å bridge netfilter
sysctl net.bridge.bridge-nf-call-iptables
# –û–∂–∏–¥–∞–µ—Ç—Å—è: net.bridge.bridge-nf-call-iptables = 1

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥—É–ª–∏ —è–¥—Ä–∞
lsmod | grep overlay
lsmod | grep br_netfilter
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
```

### 5.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ containerd

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é containerd
containerd --version
# –û–∂–∏–¥–∞–µ—Ç—Å—è: containerd.io 1.7.18

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å containerd
sudo systemctl status containerd
# –û–∂–∏–¥–∞–µ—Ç—Å—è: active (running)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é containerd
sudo cat /etc/containerd/config.toml | grep SystemdCgroup
# –û–∂–∏–¥–∞–µ—Ç—Å—è: SystemdCgroup = true
```

### 5.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Kubernetes –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é kubeadm
kubeadm version
# –û–∂–∏–¥–∞–µ—Ç—Å—è: v1.31.2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é kubelet
kubelet --version
# –û–∂–∏–¥–∞–µ—Ç—Å—è: v1.31.2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é kubectl
kubectl version --client
# –û–∂–∏–¥–∞–µ—Ç—Å—è: v1.31.2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å kubelet
sudo systemctl status kubelet
# –û–∂–∏–¥–∞–µ—Ç—Å—è: enabled, –Ω–æ –Ω–µ running (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
```

### 5.5. –ü—Ä–æ–≤–µ—Ä–∫–∞ CNI plugins

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É CNI plugins
ls /opt/cni/bin/
# –û–∂–∏–¥–∞–µ—Ç—Å—è: bridge, host-local, loopback, portmap, tuning, etc.

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la /opt/cni/bin/
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
```

---

## –≠—Ç–∞–ø 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏

### 6.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS —Å–µ—Ä–≤–µ—Ä—ã
cat /etc/resolv.conf
# –û–∂–∏–¥–∞–µ—Ç—Å—è: nameserver 172.17.10.3, nameserver 8.8.8.8

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑–æ–ª–≤–∏–Ω–≥
nslookup google.com
# –û–∂–∏–¥–∞–µ—Ç—Å—è: —Ä–µ–∑–æ–ª–≤–∏–Ω–≥ –≤ IP

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑–æ–ª–≤–∏–Ω–≥ Kubernetes
nslookup kubernetes.io
# –û–∂–∏–¥–∞–µ—Ç—Å—è: —Ä–µ–∑–æ–ª–≤–∏–Ω–≥ –≤ IP
```

### 6.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ping –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
ping -c 3 8.8.8.8
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –ø–∞–∫–µ—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ vCenter
curl -k https://<vcenter-ip>
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –æ—Ç–≤–µ—Ç –æ—Ç vCenter

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ container registry
curl -I https://registry.k8s.io
# –û–∂–∏–¥–∞–µ—Ç—Å—è: HTTP –æ—Ç–≤–µ—Ç
```

### 6.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ping gateway
ping -c 3 10.246.10.1
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –ø–∞–∫–µ—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ping –¥—Ä—É–≥–∏—Ö –Ω–æ–¥ (–µ—Å–ª–∏ –µ—Å—Ç—å)
ping -c 3 10.246.10.10
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –ø–∞–∫–µ—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
```

---

## –≠—Ç–∞–ø 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ kubeadm

### 7.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ kubelet –Ω–µ –∑–∞–ø—É—â–µ–Ω (–Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Template)
sudo systemctl status kubelet
# –û–∂–∏–¥–∞–µ—Ç—Å—è: enabled, –Ω–æ –Ω–µ running

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é kubelet
sudo cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å containerd socket
ls -la /var/run/containerd/containerd.sock
# –û–∂–∏–¥–∞–µ—Ç—Å—è: socket —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

### 7.2. –¢–µ—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ kubeadm init

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
sudo kubeadm config images list
# –û–∂–∏–¥–∞–µ—Ç—Å—è: —Å–ø–∏—Å–æ–∫ –æ–±—Ä–∞–∑–æ–≤ Kubernetes

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π
sudo kubeadm version
# –û–∂–∏–¥–∞–µ—Ç—Å—è: v1.31.2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
sudo kubeadm init --dry-run
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –æ—à–∏–±–æ–∫
```

---

## –≠—Ç–∞–ø 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 8.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h
# –û–∂–∏–¥–∞–µ—Ç—Å—è: —Ä–∞–∑—É–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (~80 GB)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ
df -h / | awk 'NR==2 {print $4}'
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã
```

### 8.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—â—É—é –ø–∞–º—è—Ç—å
free -h
# –û–∂–∏–¥–∞–µ—Ç—Å—è: ~8 GB

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—É—é –ø–∞–º—è—Ç—å
free -h | awk 'NR==2 {print $7}'
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è Kubernetes
```

### 8.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ CPU

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU
nproc
# –û–∂–∏–¥–∞–µ—Ç—Å—è: 2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É CPU
top -bn1 | grep "Cpu(s)"
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –Ω–∏–∑–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
```

---

## –≠—Ç–∞–ø 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 9.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é SSH
sudo cat /etc/ssh/sshd_config | grep -E "PermitRootLogin|PasswordAuthentication"
# –û–∂–∏–¥–∞–µ—Ç—Å—è: PermitRootLogin no, PasswordAuthentication no

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É
ssh k8s-admin@10.246.10.250
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–∞—Ä–æ–ª—è
```

### 9.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å firewall
sudo ufw status
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –∞–∫—Ç–∏–≤–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ firewall
sudo ufw status numbered
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è SSH –∏ Kubernetes –ø–æ—Ä—Ç–æ–≤
```

---

## –≠—Ç–∞–ø 10: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 10.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
./scripts/validate-vm-template.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—á–µ—Ç
cat /tmp/cleanup-report-*.txt
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –æ—Ç—á–µ—Ç –æ–± —É—Å–ø–µ—à–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

### 10.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ Production

- [ ] ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] ‚úÖ –í–µ—Ä—Å–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- [ ] ‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] ‚úÖ –°–µ—Ç–µ–≤–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ‚úÖ Cloud-init –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- [ ] ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- [ ] ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: VM –Ω–µ –∫–ª–æ–Ω–∏—Ä—É–µ—Ç—Å—è
**–°–∏–º–ø—Ç–æ–º—ã:** –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ Template
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Template –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–∫–ª—é—á–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Template
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ –≤ datastore

### –ü—Ä–æ–±–ª–µ–º–∞ 2: cloud-init –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–°–∏–º–ø—Ç–æ–º—ã:** VM –∫–ª–æ–Ω–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ cloud-init: `sudo journalctl -u cloud-init`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ cloud-init —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Template

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Kubernetes –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
**–°–∏–º–ø—Ç–æ–º—ã:** containerd –∏–ª–∏ kubelet –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `sudo journalctl -u containerd`

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –°–µ—Ç–µ–≤–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–°–∏–º–ø—Ç–æ–º—ã:** –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ SSH –∏–ª–∏ ping
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ –≤ vSphere
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é netplan
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ NSX-T

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Template –≥–æ—Ç–æ–≤, –µ—Å–ª–∏:**
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Cloud-init –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è kubeadm

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. Template –≥–æ—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Production –∫–ª–∞—Å—Ç–µ—Ä–∞
2. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å Control Plane –∏ Worker –Ω–æ–¥—ã
3. –ü—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞

---

**–í–∞–∂–Ω–æ:** –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Template –≤ Production!
